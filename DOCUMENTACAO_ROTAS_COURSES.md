# üéì Documenta√ß√£o Completa - Rotas de Cursos

## Vis√£o Geral
O arquivo `routes/courses.js` cont√©m o sistema completo de gerenciamento de cursos online, incluindo CRUD de cursos, m√≥dulos, aulas, sistema de matr√≠culas, progresso dos alunos, upload de m√≠dias e controle de acesso. √â o cora√ß√£o da plataforma educacional.

## Estrutura de Dados
- **Cursos**: Conte√∫do principal com instrutor, m√≥dulos e configura√ß√µes
- **M√≥dulos**: Agrupamento l√≥gico de aulas dentro de um curso
- **Aulas**: Conte√∫do individual (v√≠deo, texto, quiz) com progresso tracking
- **Matr√≠culas**: Liga√ß√£o entre aluno e curso com dados de acesso
- **Progresso**: Tracking detalhado por aula e curso completo

## Funcionalidades Principais
- **CRUD Completo**: Cursos, m√≥dulos e aulas
- **Sistema de Matr√≠culas**: Autom√°tico via webhook de pagamento
- **Progresso Avan√ßado**: Tracking por aula e curso
- **Controle de Acesso**: Verifica√ß√µes de permiss√£o
- **Upload de M√≠dia**: V√≠deos, materiais e thumbnails
- **Streaming Seguro**: URLs tempor√°rias com token

---

## üìö GEST√ÉO DE CURSOS

### GET /api/courses/my-courses
**Descri√ß√£o**: Busca cursos do aluno logado (cursos matriculados)

**Autentica√ß√£o**: Obrigat√≥ria

**Headers**:
```
Authorization: Bearer jwt_token
```

**Resposta de Sucesso (200)**:
```json
{
  "success": true,
  "courses": [
    {
      "enrollment": {
        "id": "uuid-matricula-123",
        "enrolledAt": "2024-12-31T18:30:00.000Z",
        "status": "active",
        "progress": 65,
        "expiresAt": "2025-12-31T18:30:00.000Z"
      },
      "course": {
        "id": "uuid-curso-456",
        "title": "Curso de JavaScript Avan√ßado",
        "description": "Aprenda JavaScript do zero ao avan√ßado",
        "thumbnailUrl": "https://exemplo.com/thumb.jpg",
        "trailerUrl": "https://exemplo.com/trailer.mp4",
        "duration": 1800,
        "level": "intermediate",
        "category": "programacao",
        "status": "published",
        "product": {
          "id": "uuid-produto-789",
          "name": "Curso de JavaScript Avan√ßado",
          "price": 197.50,
          "imageUrl": "https://exemplo.com/image.jpg"
        },
        "instructor": {
          "id": "uuid-instrutor-321",
          "name": "Jo√£o Silva",
          "email": "joao@email.com"
        },
        "modules": [
          {
            "id": "uuid-modulo-111",
            "title": "Fundamentos",
            "orderIndex": 0,
            "duration": 450,
            "isFree": false,
            "lessonsCount": 8,
            "lessons": [
              {
                "id": "uuid-aula-222",
                "title": "Introdu√ß√£o ao JavaScript",
                "duration": 30,
                "isFree": true,
                "orderIndex": 0
              }
            ]
          }
        ]
      },
      "purchase": {
        "id": "uuid-pedido-555",
        "amount": 197.50,
        "status": "completed",
        "paymentMethod": "credit_card"
      }
    }
  ],
  "total": 1,
  "user": {
    "id": "uuid-usuario-666",
    "name": "Maria Santos",
    "email": "maria@email.com"
  }
}
```

**Campos da Matr√≠cula**:
- `enrolledAt`: Data de matr√≠cula
- `status`: Status da matr√≠cula (active, suspended, expired)
- `progress`: Progresso em % (0-100)
- `expiresAt`: Data de expira√ß√£o do acesso

**Uso**: √Årea do aluno para ver todos os cursos matriculados

**Erros Poss√≠veis**:
- `401`: Token inv√°lido ou expirado
- `500`: Erro interno do servidor

---

### GET /api/courses
**Descri√ß√£o**: Busca cursos do instrutor logado ou cursos matriculados (se aluno)

**Autentica√ß√£o**: Obrigat√≥ria

**Query Parameters**:
- `category` (opcional): Filtrar por categoria
- `status` (opcional): Filtrar por status (draft, published, archived)
- `student_id` (opcional): Filtrar por aluno espec√≠fico

**Comportamento por Role**:
- **Instrutor/Seller**: Retorna apenas cursos criados por ele
- **Aluno**: Retorna cursos onde est√° matriculado

**Resposta de Sucesso (200)**:
```json
[
  {
    "id": "uuid-curso-123",
    "title": "Curso de React Avan√ßado",
    "description": "Domine React e suas principais bibliotecas",
    "thumbnailUrl": "https://exemplo.com/react-thumb.jpg",
    "trailerUrl": "https://exemplo.com/react-trailer.mp4",
    "durationMinutes": 2400,
    "level": "advanced",
    "category": "frontend",
    "tags": ["react", "javascript", "frontend"],
    "status": "published",
    "createdAt": "2024-12-01T10:00:00.000Z",
    "product": {
      "id": "uuid-produto-456",
      "name": "Curso de React Avan√ßado",
      "price": 297.50,
      "imageUrl": "https://exemplo.com/react-image.jpg"
    },
    "instructor": {
      "id": "uuid-instrutor-789",
      "name": "Pedro Oliveira",
      "email": "pedro@email.com"
    },
    "enrollment": null
  }
]
```

**Filtros Dispon√≠veis**:
- **Por Categoria**: `?category=programacao`
- **Por Status**: `?status=published`
- **Por Aluno**: `?student_id=uuid-aluno-123`

**Uso**: Dashboard do instrutor ou biblioteca de cursos do aluno

**Erros Poss√≠veis**:
- `401`: Token inv√°lido
- `500`: Erro interno do servidor

---

### GET /api/courses/:course_id
**Descri√ß√£o**: Busca curso espec√≠fico com m√≥dulos e aulas completos

**Par√¢metros**:
- `course_id` (string): UUID do curso

**Query Parameters**:
- `student_id` (opcional): ID do aluno para incluir progresso

**Resposta de Sucesso (200)**:
```json
{
  "success": true,
  "course": {
    "id": "uuid-curso-123",
    "title": "Curso de Node.js Completo",
    "description": "Aprenda backend com Node.js, Express e MongoDB",
    "thumbnailUrl": "https://exemplo.com/nodejs-thumb.jpg",
    "trailerUrl": "https://exemplo.com/nodejs-trailer.mp4",
    "durationMinutes": 3600,
    "level": "intermediate",
    "category": "backend",
    "tags": ["nodejs", "express", "mongodb"],
    "settings": {
      "allowDownloads": false,
      "hasCertificate": true,
      "accessDuration": 365
    },
    "status": "published",
    "createdAt": "2024-11-15T14:00:00.000Z",
    "product": {
      "id": "uuid-produto-789",
      "name": "Curso de Node.js Completo",
      "price": 247.50,
      "imageUrl": "https://exemplo.com/nodejs-image.jpg"
    },
    "instructor": {
      "id": "uuid-instrutor-456",
      "name": "Ana Silva",
      "email": "ana@email.com"
    },
    "modules": [
      {
        "id": "uuid-modulo-111",
        "title": "Introdu√ß√£o ao Node.js",
        "description": "Fundamentos e configura√ß√£o",
        "orderIndex": 0,
        "durationMinutes": 240,
        "isFree": false,
        "lessons": [
          {
            "id": "uuid-aula-222",
            "title": "O que √© Node.js",
            "description": "Conceitos fundamentais",
            "contentType": "video",
            "contentUrl": "https://exemplo.com/aula1.mp4",
            "contentData": {
              "quality": "1080p",
              "hasSubtitles": true
            },
            "durationMinutes": 45,
            "orderIndex": 0,
            "isFree": true,
            "transcript": "Transcri√ß√£o da aula..."
          }
        ]
      }
    ],
    "enrollment": {
      "id": "uuid-matricula-333",
      "enrolledAt": "2024-12-20T09:00:00.000Z",
      "status": "active",
      "progressPercentage": 25,
      "progress": [
        {
          "lessonId": "uuid-aula-222",
          "status": "completed",
          "progressPercentage": 100,
          "timeSpentMinutes": 45,
          "lastPosition": 2700,
          "completedAt": "2024-12-21T10:30:00.000Z"
        }
      ]
    }
  }
}
```

**Tipos de Conte√∫do**:
- `video`: V√≠deo-aula
- `text`: Conte√∫do textual
- `quiz`: Question√°rio
- `file`: Arquivo para download

**Configura√ß√µes do Curso**:
- `allowDownloads`: Permite download das aulas
- `hasCertificate`: Curso oferece certificado
- `accessDuration`: Dura√ß√£o do acesso em dias

**Uso**: P√°gina detalhada do curso ou player de aulas

**Erros Poss√≠veis**:
- `404`: Curso n√£o encontrado
- `500`: Erro interno do servidor

---

### POST /api/courses
**Descri√ß√£o**: Cria novo curso (usu√°rio logado como instrutor)

**Autentica√ß√£o**: Obrigat√≥ria

**Body Parameters**:
```json
{
  "title": "Curso de Python Avan√ßado",
  "description": "Domine Python com projetos pr√°ticos",
  "thumbnailUrl": "https://exemplo.com/python-thumb.jpg",
  "trailerUrl": "https://exemplo.com/python-trailer.mp4",
  "durationMinutes": 2000,
  "level": "advanced",
  "category": "programacao",
  "tags": ["python", "django", "data-science"],
  "settings": {
    "allowDownloads": true,
    "hasCertificate": true,
    "accessDuration": 365
  },
  "status": "draft",
  "productId": "uuid-produto-existente"
}
```

**Par√¢metros Obrigat√≥rios**:
- `title` (string): Nome do curso

**Par√¢metros Opcionais**:
- `description` (string): Descri√ß√£o detalhada
- `thumbnailUrl` (string): URL da imagem de capa
- `trailerUrl` (string): URL do v√≠deo de apresenta√ß√£o
- `durationMinutes` (number): Dura√ß√£o total estimada
- `level` (string): N√≠vel (beginner, intermediate, advanced)
- `category` (string): Categoria do curso
- `tags` (array): Tags para busca
- `settings` (object): Configura√ß√µes espec√≠ficas
- `status` (string): Status inicial (draft, published)
- `productId` (string): ID de produto existente

**Cria√ß√£o Autom√°tica de Produto**:
Se `productId` n√£o fornecido, sistema cria produto automaticamente:
```javascript
{
  "name": "Curso de Python Avan√ßado",
  "description": "Curso online: Curso de Python Avan√ßado",
  "price": 0,
  "slug": "curso-de-python-avancado",
  "category": "curso",
  "seller_id": "uuid-instrutor-logado"
}
```

**Resposta de Sucesso (201)**:
```json
{
  "success": true,
  "message": "Curso criado com sucesso",
  "course": {
    "id": "uuid-curso-novo",
    "title": "Curso de Python Avan√ßado",
    "description": "Domine Python com projetos pr√°ticos",
    "thumbnailUrl": "https://exemplo.com/python-thumb.jpg",
    "trailerUrl": "https://exemplo.com/python-trailer.mp4",
    "durationMinutes": 2000,
    "level": "advanced",
    "category": "programacao",
    "tags": ["python", "django", "data-science"],
    "settings": {
      "allowDownloads": true,
      "hasCertificate": true,
      "accessDuration": 365
    },
    "status": "draft",
    "createdAt": "2024-12-31T18:30:00.000Z"
  }
}
```

**Seguran√ßa**: `instructor_id` sempre definido como usu√°rio logado

**Uso**: Cria√ß√£o de novos cursos na plataforma

**Erros Poss√≠veis**:
- `400`: T√≠tulo obrigat√≥rio ausente
- `404`: Produto n√£o encontrado (se productId fornecido)
- `400`: J√° existe curso para o produto
- `401`: Token inv√°lido
- `500`: Erro interno do servidor

---

### PUT /api/courses/:course_id
**Descri√ß√£o**: Atualiza curso (apenas se for do instrutor logado)

**Par√¢metros**:
- `course_id` (string): UUID do curso

**Autentica√ß√£o**: Obrigat√≥ria

**Body Parameters** (todos opcionais):
```json
{
  "title": "Novo T√≠tulo do Curso",
  "description": "Nova descri√ß√£o",
  "thumbnailUrl": "https://exemplo.com/nova-thumb.jpg",
  "trailerUrl": "https://exemplo.com/novo-trailer.mp4",
  "durationMinutes": 2500,
  "level": "intermediate",
  "category": "nova-categoria",
  "tags": ["tag1", "tag2"],
  "settings": {
    "allowDownloads": false,
    "hasCertificate": false
  },
  "status": "published"
}
```

**Seguran√ßa**: Verifica se curso pertence ao instrutor logado

**Resposta de Sucesso (200)**:
```json
{
  "success": true,
  "message": "Curso atualizado com sucesso",
  "course": {
    "id": "uuid-curso-123",
    "title": "Novo T√≠tulo do Curso",
    "description": "Nova descri√ß√£o",
    "thumbnailUrl": "https://exemplo.com/nova-thumb.jpg",
    "trailerUrl": "https://exemplo.com/novo-trailer.mp4",
    "durationMinutes": 2500,
    "level": "intermediate",
    "category": "nova-categoria",
    "tags": ["tag1", "tag2"],
    "settings": {
      "allowDownloads": false,
      "hasCertificate": false
    },
    "status": "published",
    "updatedAt": "2024-12-31T18:35:00.000Z"
  }
}
```

**Uso**: Edi√ß√£o de cursos existentes

**Erros Poss√≠veis**:
- `404`: Curso n√£o encontrado ou sem permiss√£o
- `401`: Token inv√°lido
- `500`: Erro interno do servidor

---

### DELETE /api/courses/:course_id
**Descri√ß√£o**: Deleta curso completo (apenas se for do instrutor logado)

**Par√¢metros**:
- `course_id` (string): UUID do curso

**Autentica√ß√£o**: Obrigat√≥ria

**Seguran√ßa**: Verifica se curso pertence ao instrutor logado

**Efeito Cascade**: Deleta automaticamente:
- Todos os m√≥dulos do curso
- Todas as aulas dos m√≥dulos
- Todas as matr√≠culas
- Todo o progresso dos alunos

**Resposta de Sucesso (200)**:
```json
{
  "success": true,
  "message": "Curso deletado com sucesso"
}
```

**Uso**: Remo√ß√£o definitiva de cursos

**Erros Poss√≠veis**:
- `404`: Curso n√£o encontrado ou sem permiss√£o
- `401`: Token inv√°lido
- `500`: Erro interno do servidor

---

## üìÇ GEST√ÉO DE M√ìDULOS

### POST /api/courses/:course_id/modules
**Descri√ß√£o**: Cria m√≥dulo no curso

**Par√¢metros**:
- `course_id` (string): UUID do curso

**Autentica√ß√£o**: Obrigat√≥ria

**Body Parameters**:
```json
{
  "title": "M√≥dulo de APIs REST",
  "description": "Aprenda a criar APIs com Express",
  "orderIndex": 2,
  "durationMinutes": 480,
  "isFree": false
}
```

**Par√¢metros Obrigat√≥rios**:
- `title` (string): Nome do m√≥dulo

**Par√¢metros Opcionais**:
- `description` (string): Descri√ß√£o do m√≥dulo
- `orderIndex` (number): Ordem de exibi√ß√£o (auto se omitido)
- `durationMinutes` (number): Dura√ß√£o estimada
- `isFree` (boolean): Se √© m√≥dulo gratuito

**Resposta de Sucesso (201)**:
```json
{
  "success": true,
  "message": "M√≥dulo criado com sucesso",
  "module": {
    "id": "uuid-modulo-novo",
    "title": "M√≥dulo de APIs REST",
    "description": "Aprenda a criar APIs com Express",
    "orderIndex": 2,
    "durationMinutes": 480,
    "isFree": false,
    "createdAt": "2024-12-31T18:40:00.000Z"
  }
}
```

**Auto-Ordering**: Se `orderIndex` omitido, usa pr√≥ximo √≠ndice dispon√≠vel

**Uso**: Organiza√ß√£o de conte√∫do em m√≥dulos

**Erros Poss√≠veis**:
- `404`: Curso n√£o encontrado
- `400`: T√≠tulo obrigat√≥rio
- `401`: Token inv√°lido
- `500`: Erro interno do servidor

---

### PUT /api/courses/:course_id/modules/:module_id
**Descri√ß√£o**: Atualiza m√≥dulo existente

**Par√¢metros**:
- `course_id` (string): UUID do curso
- `module_id` (string): UUID do m√≥dulo

**Autentica√ß√£o**: Obrigat√≥ria

**Body Parameters** (todos opcionais):
```json
{
  "title": "Novo T√≠tulo do M√≥dulo",
  "description": "Nova descri√ß√£o",
  "orderIndex": 1,
  "durationMinutes": 600,
  "isFree": true
}
```

**Resposta de Sucesso (200)**:
```json
{
  "success": true,
  "message": "M√≥dulo atualizado com sucesso",
  "module": {
    "id": "uuid-modulo-123",
    "title": "Novo T√≠tulo do M√≥dulo",
    "description": "Nova descri√ß√£o",
    "orderIndex": 1,
    "durationMinutes": 600,
    "isFree": true,
    "updatedAt": "2024-12-31T18:45:00.000Z"
  }
}
```

**Uso**: Edi√ß√£o de m√≥dulos existentes

**Erros Poss√≠veis**:
- `404`: M√≥dulo n√£o encontrado
- `401`: Token inv√°lido
- `500`: Erro interno do servidor

---

### DELETE /api/courses/:course_id/modules/:module_id
**Descri√ß√£o**: Deleta m√≥dulo e todas suas aulas

**Par√¢metros**:
- `course_id` (string): UUID do curso
- `module_id` (string): UUID do m√≥dulo

**Autentica√ß√£o**: Obrigat√≥ria

**Efeito Cascade**: Deleta todas as aulas do m√≥dulo

**Resposta de Sucesso (200)**:
```json
{
  "success": true,
  "message": "M√≥dulo exclu√≠do com sucesso"
}
```

**Uso**: Remo√ß√£o de m√≥dulos completos

**Erros Poss√≠veis**:
- `404`: M√≥dulo n√£o encontrado
- `401`: Token inv√°lido
- `500`: Erro interno do servidor

---

## üé• GEST√ÉO DE AULAS

### POST /api/courses/:course_id/modules/:module_id/lessons
**Descri√ß√£o**: Cria aula no m√≥dulo

**Par√¢metros**:
- `course_id` (string): UUID do curso
- `module_id` (string): UUID do m√≥dulo

**Autentica√ß√£o**: Obrigat√≥ria

**Body Parameters**:
```json
{
  "title": "Criando sua primeira API",
  "description": "Passo a passo para criar uma API REST",
  "contentType": "video",
  "contentUrl": "https://exemplo.com/aula-api.mp4",
  "contentData": {
    "quality": "1080p",
    "hasSubtitles": true,
    "chapters": [
      { "time": 0, "title": "Introdu√ß√£o" },
      { "time": 300, "title": "Configura√ß√£o" }
    ]
  },
  "durationMinutes": 60,
  "orderIndex": 1,
  "isFree": false,
  "transcript": "Nesta aula veremos como..."
}
```

**Par√¢metros Obrigat√≥rios**:
- `title` (string): Nome da aula

**Par√¢metros Opcionais**:
- `description` (string): Descri√ß√£o da aula
- `contentType` (string): Tipo (video, text, quiz, file)
- `contentUrl` (string): URL do conte√∫do
- `contentData` (object): Metadados do conte√∫do
- `durationMinutes` (number): Dura√ß√£o da aula
- `orderIndex` (number): Ordem de exibi√ß√£o
- `isFree` (boolean): Se √© aula gratuita
- `transcript` (string): Transcri√ß√£o da aula

**Resposta de Sucesso (201)**:
```json
{
  "success": true,
  "message": "Aula criada com sucesso",
  "lesson": {
    "id": "uuid-aula-nova",
    "title": "Criando sua primeira API",
    "description": "Passo a passo para criar uma API REST",
    "contentType": "video",
    "contentUrl": "https://exemplo.com/aula-api.mp4",
    "contentData": {
      "quality": "1080p",
      "hasSubtitles": true,
      "chapters": [
        { "time": 0, "title": "Introdu√ß√£o" },
        { "time": 300, "title": "Configura√ß√£o" }
      ]
    },
    "durationMinutes": 60,
    "orderIndex": 1,
    "isFree": false,
    "transcript": "Nesta aula veremos como...",
    "createdAt": "2024-12-31T19:00:00.000Z"
  }
}
```

**Tipos de Conte√∫do Suportados**:
- `video`: V√≠deo-aula
- `text`: Artigo ou texto
- `quiz`: Question√°rio interativo
- `file`: Arquivo para download

**Uso**: Cria√ß√£o de conte√∫do educacional

**Erros Poss√≠veis**:
- `404`: M√≥dulo n√£o encontrado
- `400`: T√≠tulo obrigat√≥rio
- `401`: Token inv√°lido
- `500`: Erro interno do servidor

---

### PUT /api/courses/:course_id/modules/:module_id/lessons/:lesson_id
**Descri√ß√£o**: Atualiza aula existente

**Par√¢metros**:
- `course_id` (string): UUID do curso
- `module_id` (string): UUID do m√≥dulo
- `lesson_id` (string): UUID da aula

**Autentica√ß√£o**: Obrigat√≥ria

**Body Parameters** (todos opcionais):
```json
{
  "title": "Novo T√≠tulo da Aula",
  "description": "Nova descri√ß√£o",
  "contentType": "video",
  "contentUrl": "https://exemplo.com/nova-aula.mp4",
  "contentData": {
    "quality": "4K",
    "hasSubtitles": true
  },
  "durationMinutes": 75,
  "orderIndex": 2,
  "isFree": true,
  "transcript": "Nova transcri√ß√£o..."
}
```

**Resposta de Sucesso (200)**:
```json
{
  "success": true,
  "message": "Aula atualizada com sucesso",
  "lesson": {
    "id": "uuid-aula-123",
    "title": "Novo T√≠tulo da Aula",
    "description": "Nova descri√ß√£o",
    "contentType": "video",
    "contentUrl": "https://exemplo.com/nova-aula.mp4",
    "contentData": {
      "quality": "4K",
      "hasSubtitles": true
    },
    "durationMinutes": 75,
    "orderIndex": 2,
    "isFree": true,
    "transcript": "Nova transcri√ß√£o...",
    "updatedAt": "2024-12-31T19:10:00.000Z"
  }
}
```

**Uso**: Edi√ß√£o de aulas existentes

**Erros Poss√≠veis**:
- `404`: Aula n√£o encontrada
- `401`: Token inv√°lido
- `500`: Erro interno do servidor

---

### DELETE /api/courses/:course_id/modules/:module_id/lessons/:lesson_id
**Descri√ß√£o**: Deleta aula espec√≠fica

**Par√¢metros**:
- `course_id` (string): UUID do curso
- `module_id` (string): UUID do m√≥dulo
- `lesson_id` (string): UUID da aula

**Autentica√ß√£o**: Obrigat√≥ria

**Resposta de Sucesso (200)**:
```json
{
  "success": true,
  "message": "Aula exclu√≠da com sucesso"
}
```

**Uso**: Remo√ß√£o de aulas espec√≠ficas

**Erros Poss√≠veis**:
- `404`: Aula n√£o encontrada
- `401`: Token inv√°lido
- `500`: Erro interno do servidor

---

## üìù SISTEMA DE MATR√çCULAS

### POST /api/courses/:course_id/enroll
**Descri√ß√£o**: Matricula aluno no curso (usado ap√≥s compra)

**Par√¢metros**:
- `course_id` (string): UUID do curso

**Autentica√ß√£o**: Obrigat√≥ria

**Body Parameters**:
```json
{
  "studentId": "uuid-aluno-123",
  "orderId": "uuid-pedido-456"
}
```

**Par√¢metros Obrigat√≥rios**:
- `studentId` (string): ID do aluno
- `orderId` (string): ID do pedido de compra

**Resposta de Sucesso (201)**:
```json
{
  "success": true,
  "message": "Matr√≠cula realizada com sucesso",
  "enrollment": {
    "id": "uuid-matricula-789",
    "courseId": "uuid-curso-123",
    "studentId": "uuid-aluno-123",
    "orderId": "uuid-pedido-456",
    "enrolledAt": "2024-12-31T19:15:00.000Z",
    "status": "active",
    "progressPercentage": 0
  }
}
```

**Valida√ß√µes**:
- Verifica se curso existe
- Verifica se aluno existe
- Verifica se pedido existe
- Evita matr√≠culas duplicadas

**Status da Matr√≠cula**:
- `active`: Acesso liberado
- `suspended`: Acesso suspenso
- `expired`: Acesso expirado

**Uso**: Automa√ß√£o via webhook de pagamento

**Erros Poss√≠veis**:
- `404`: Curso, aluno ou pedido n√£o encontrado
- `400`: Aluno j√° matriculado
- `400`: Campos obrigat√≥rios ausentes
- `401`: Token inv√°lido
- `500`: Erro interno do servidor

---

### GET /api/courses/:course_id/enrollments
**Descri√ß√£o**: Lista matr√≠culas do curso (para instrutor)

**Par√¢metros**:
- `course_id` (string): UUID do curso

**Autentica√ß√£o**: Obrigat√≥ria

**Resposta de Sucesso (200)**:
```json
{
  "success": true,
  "enrollments": [
    {
      "id": "uuid-matricula-123",
      "enrolledAt": "2024-12-20T10:00:00.000Z",
      "status": "active",
      "progressPercentage": 75,
      "completedAt": null,
      "student": {
        "id": "uuid-aluno-456",
        "name": "Ana Silva",
        "email": "ana@email.com"
      },
      "order": {
        "id": "uuid-pedido-789",
        "amount": 197.50,
        "createdAt": "2024-12-20T09:45:00.000Z"
      }
    }
  ]
}
```

**Ordena√ß√£o**: Por data de matr√≠cula (mais recentes primeiro)

**Uso**: Dashboard do instrutor para acompanhar alunos

**Erros Poss√≠veis**:
- `401`: Token inv√°lido
- `500`: Erro interno do servidor

---

### GET /api/courses/enrollment-status/:courseId/:studentEmail
**Descri√ß√£o**: Verifica status de matr√≠cula de um aluno espec√≠fico

**Par√¢metros**:
- `courseId` (string): UUID do curso
- `studentEmail` (string): Email do aluno

**Autentica√ß√£o**: Obrigat√≥ria

**Resposta - N√£o Matriculado (200)**:
```json
{
  "enrolled": false,
  "hasAccount": true,
  "student": {
    "id": "uuid-aluno-123",
    "name": "Jo√£o Silva",
    "email": "joao@email.com"
  },
  "message": "N√£o matriculado neste curso"
}
```

**Resposta - Matriculado (200)**:
```json
{
  "enrolled": true,
  "hasAccount": true,
  "enrollment": {
    "id": "uuid-matricula-456",
    "status": "active",
    "enrolledAt": "2024-12-15T14:30:00.000Z",
    "progressPercentage": 45,
    "accessData": {
      "enrolledVia": "purchase",
      "email": "joao@email.com"
    }
  },
  "student": {
    "id": "uuid-aluno-123",
    "name": "Jo√£o Silva",
    "email": "joao@email.com"
  },
  "course": {
    "id": "uuid-curso-789",
    "title": "Curso de JavaScript",
    "status": "published"
  },
  "order": {
    "id": "uuid-pedido-321",
    "status": "completed",
    "createdAt": "2024-12-15T14:25:00.000Z"
  }
}
```

**Uso**: Verifica√ß√£o de acesso antes de liberar conte√∫do

**Erros Poss√≠veis**:
- `401`: Token inv√°lido
- `500`: Erro interno do servidor

---

## üìä SISTEMA DE PROGRESSO

### PUT /api/courses/:course_id/progress
**Descri√ß√£o**: Atualiza progresso da aula (vers√£o legacy)

**Par√¢metros**:
- `course_id` (string): UUID do curso

**Autentica√ß√£o**: Obrigat√≥ria

**Body Parameters**:
```json
{
  "studentId": "uuid-aluno-123",
  "lessonId": "uuid-aula-456",
  "progressPercentage": 85,
  "timeSpentMinutes": 25,
  "lastPosition": 1530,
  "status": "in_progress"
}
```

**Par√¢metros Obrigat√≥rios**:
- `studentId` (string): ID do aluno
- `lessonId` (string): ID da aula

**Par√¢metros Opcionais**:
- `progressPercentage` (number): % assistido (0-100)
- `timeSpentMinutes` (number): Tempo gasto em minutos
- `lastPosition` (number): √öltima posi√ß√£o em segundos
- `status` (string): Status (in_progress, completed)

**Resposta de Sucesso (200)**:
```json
{
  "success": true,
  "message": "Progresso atualizado com sucesso",
  "progress": {
    "lessonId": "uuid-aula-456",
    "status": "in_progress",
    "progressPercentage": 85,
    "timeSpentMinutes": 25,
    "lastPosition": 1530,
    "completedAt": null
  },
  "courseProgress": {
    "percentage": 45,
    "completedLessons": 8,
    "totalLessons": 18
  }
}
```

**C√°lculo Autom√°tico**:
- Progresso geral do curso
- Contagem de aulas completadas
- Atualiza√ß√£o de tempo total gasto

**Uso**: Tracking durante assistir aulas

**Erros Poss√≠veis**:
- `404`: Matr√≠cula n√£o encontrada
- `400`: Campos obrigat√≥rios ausentes
- `401`: Token inv√°lido
- `500`: Erro interno do servidor

---

### GET /api/courses/:courseId/progress
**Descri√ß√£o**: Progresso completo do curso para o aluno logado

**Par√¢metros**:
- `courseId` (string): UUID do curso

**Autentica√ß√£o**: Obrigat√≥ria

**Resposta de Sucesso (200)**:
```json
{
  "course": {
    "id": "uuid-curso-123",
    "title": "Curso de React Avan√ßado",
    "description": "Domine React e suas principais bibliotecas",
    "thumbnailUrl": "https://exemplo.com/react-thumb.jpg",
    "instructor": {
      "name": "Pedro Silva",
      "avatar": "https://exemplo.com/pedro-avatar.jpg"
    },
    "totalDuration": 7200,
    "certificateAvailable": true
  },
  "enrollment": {
    "enrolledAt": "2024-12-01T10:00:00.000Z",
    "expiresAt": "2025-12-01T10:00:00.000Z",
    "status": "active"
  },
  "progress": {
    "totalLessons": 24,
    "completedLessons": 15,
    "progressPercentage": 63,
    "timeSpent": 10800,
    "estimatedTimeToComplete": 3240,
    "lastAccessed": "2024-12-30T15:30:00.000Z",
    "completionDate": null,
    "certificateEarned": false
  },
  "modules": [
    {
      "id": "uuid-modulo-111",
      "title": "Fundamentos do React",
      "description": "Conceitos b√°sicos e componentes",
      "order": 0,
      "totalLessons": 6,
      "completedLessons": 6,
      "isCompleted": true,
      "lessons": [
        {
          "id": "uuid-aula-222",
          "title": "Introdu√ß√£o ao React",
          "type": "video",
          "duration": 45,
          "order": 0,
          "isCompleted": true,
          "completedAt": "2024-12-02T11:30:00.000Z",
          "timeSpent": 45,
          "watchedPercentage": 100,
          "isPreview": true,
          "hasAccess": true
        }
      ]
    }
  ],
  "currentLesson": {
    "id": "uuid-aula-333",
    "moduleId": "uuid-modulo-222",
    "title": "Hooks Avan√ßados",
    "watchedPercentage": 25
  },
  "nextLesson": {
    "id": "uuid-aula-444",
    "moduleId": "uuid-modulo-222",
    "title": "Context API"
  }
}
```

**M√©tricas Calculadas**:
- **Progresso Geral**: % de aulas completadas
- **Tempo Gasto**: Total de minutos assistidos
- **Tempo Estimado**: Para completar o curso
- **Certificado**: Se dispon√≠vel e eleg√≠vel

**Aula Atual**: Primeira aula n√£o completada
**Pr√≥xima Aula**: Aula seguinte √† atual

**Uso**: Dashboard do aluno e player de curso

**Erros Poss√≠veis**:
- `404`: Matr√≠cula n√£o encontrada
- `401`: Token inv√°lido
- `500`: Erro interno do servidor

---

### POST /api/courses/:courseId/lessons/:lessonId/progress
**Descri√ß√£o**: Atualiza progresso espec√≠fico de uma aula (vers√£o moderna)

**Par√¢metros**:
- `courseId` (string): UUID do curso
- `lessonId` (string): UUID da aula

**Autentica√ß√£o**: Obrigat√≥ria

**Body Parameters**:
```json
{
  "completed": true,
  "timeSpent": 5,
  "watchedPercentage": 100,
  "lastPosition": 2700
}
```

**Par√¢metros**:
- `completed` (boolean): Se aula foi completada
- `timeSpent` (number): Tempo gasto nesta sess√£o (minutos)
- `watchedPercentage` (number): % assistido (0-100)
- `lastPosition` (number): Posi√ß√£o final em segundos

**Resposta de Sucesso (200)**:
```json
{
  "success": true,
  "lesson": {
    "id": "uuid-aula-123",
    "completed": true,
    "completedAt": "2024-12-31T20:00:00.000Z",
    "timeSpent": 45,
    "watchedPercentage": 100
  },
  "course": {
    "progressPercentage": 68,
    "completedLessons": 16,
    "totalLessons": 24
  },
  "achievements": [
    {
      "type": "lesson_completed",
      "message": "Parab√©ns! Voc√™ completou mais uma aula!"
    }
  ],
  "nextLesson": {
    "id": "uuid-aula-124",
    "title": "Pr√≥xima Aula: Redux Toolkit",
    "hasAccess": true
  },
  "unlockedContent": []
}
```

**Sistema de Conquistas**:
- **Aula Completada**: Quando completa uma aula
- **Curso Completado**: Quando atinge 100%
- **M√≥dulo Completado**: Quando termina m√≥dulo

**Rec√°lculo Autom√°tico**: 
- Progresso geral do curso
- Tempo total gasto
- Data de conclus√£o (se 100%)

**Uso**: Player de aulas com tracking em tempo real

**Erros Poss√≠veis**:
- `403`: Sem acesso ao curso
- `401`: Token inv√°lido
- `500`: Erro interno do servidor

---

## üîí CONTROLE DE ACESSO

### GET /api/courses/:courseId/enrollment/status
**Descri√ß√£o**: Verifica status de matr√≠cula do usu√°rio logado

**Par√¢metros**:
- `courseId` (string): UUID do curso

**Autentica√ß√£o**: Obrigat√≥ria

**Resposta - Sem Acesso (200)**:
```json
{
  "hasAccess": false,
  "enrolled": false,
  "message": "Voc√™ n√£o est√° matriculado neste curso"
}
```

**Resposta - Com Acesso (200)**:
```json
{
  "hasAccess": true,
  "enrolled": true,
  "enrollment": {
    "id": "uuid-matricula-123",
    "status": "active",
    "enrolledAt": "2024-12-15T10:00:00.000Z",
    "expiresAt": "2025-12-15T10:00:00.000Z",
    "progressPercentage": 45
  },
  "course": {
    "id": "uuid-curso-456",
    "title": "Curso de JavaScript",
    "status": "published"
  }
}
```

**Verifica√ß√µes**:
- Se existe matr√≠cula ativa
- Se acesso n√£o expirou
- Se curso est√° publicado

**Uso**: Middleware de acesso a √°reas restritas

**Erros Poss√≠veis**:
- `401`: Token inv√°lido
- `500`: Erro interno do servidor

---

### GET /api/courses/:courseId/lessons/:lessonId/access
**Descri√ß√£o**: Verifica acesso espec√≠fico a uma aula com navega√ß√£o

**Par√¢metros**:
- `courseId` (string): UUID do curso
- `lessonId` (string): UUID da aula

**Autentica√ß√£o**: Obrigat√≥ria

**Resposta de Sucesso (200)**:
```json
{
  "hasAccess": true,
  "accessType": "full",
  "downloadAllowed": false,
  "streamUrl": "https://exemplo.com/aula.mp4?token=abc123&expires=1735689600",
  "lesson": {
    "id": "uuid-aula-123",
    "title": "Introdu√ß√£o ao React",
    "description": "Conceitos fundamentais do React",
    "type": "video",
    "duration": 2700,
    "isCompleted": false,
    "watchedPercentage": 45,
    "lastPosition": 1215,
    "materials": [
      {
        "id": "uuid-material-456",
        "name": "Slides da Aula",
        "url": "https://exemplo.com/slides.pdf",
        "type": "pdf",
        "size": 2048000
      }
    ]
  },
  "nextLesson": {
    "id": "uuid-aula-124",
    "title": "Componentes e Props",
    "hasAccess": true
  },
  "prevLesson": {
    "id": "uuid-aula-122",
    "title": "Prepara√ß√£o do Ambiente",
    "hasAccess": true
  }
}
```

**Tipos de Acesso**:
- `full`: Acesso completo
- `preview`: Apenas preview
- `denied`: Sem acesso

**URL de Streaming**:
- Token tempor√°rio para seguran√ßa
- Expira√ß√£o em 1 hora
- Prote√ß√£o contra download n√£o autorizado

**Navega√ß√£o**:
- `nextLesson`: Pr√≥xima aula na sequ√™ncia
- `prevLesson`: Aula anterior na sequ√™ncia

**Materiais**: Arquivos complementares da aula

**Uso**: Player de aulas com controle granular

**Erros Poss√≠veis**:
- `403`: Sem acesso ao curso
- `404`: Aula n√£o encontrada
- `401`: Token inv√°lido
- `500`: Erro interno do servidor

---

### GET /api/courses/:courseId/lessons/:lessonId/media
**Descri√ß√£o**: Gera URL segura de streaming/download

**Par√¢metros**:
- `courseId` (string): UUID do curso
- `lessonId` (string): UUID da aula

**Query Parameters**:
- `type` (string): Tipo de acesso (stream, download)

**Autentica√ß√£o**: Obrigat√≥ria

**Resposta de Sucesso (200)**:
```json
{
  "url": "https://exemplo.com/secure/aula.mp4?token=xyz789&expires=1735693200",
  "expiresAt": "2025-01-01T01:00:00.000Z",
  "type": "stream",
  "quality": "1080p",
  "watermark": true,
  "allowDownload": false
}
```

**Verifica√ß√µes de Seguran√ßa**:
- Verifica se usu√°rio tem acesso ao curso
- Verifica se downloads est√£o habilitados (para type=download)
- Gera token √∫nico por sess√£o

**Configura√ß√µes**:
- **Expira√ß√£o**: 1 hora por padr√£o
- **Qualidade**: Baseada no plano do curso
- **Watermark**: Para prote√ß√£o de conte√∫do
- **Download**: Controlado por configura√ß√£o do curso

**Uso**: Player de v√≠deo com URLs seguras

**Erros Poss√≠veis**:
- `403`: Sem acesso ou downloads desabilitados
- `404`: Aula n√£o encontrada
- `401`: Token inv√°lido
- `500`: Erro interno do servidor

---

## üìÅ UPLOAD DE M√çDIA

### POST /api/courses/upload
**Descri√ß√£o**: Upload de arquivos para cursos (v√≠deos, thumbnails, materiais)

**Autentica√ß√£o**: Obrigat√≥ria

**Content-Type**: `multipart/form-data`

**Form Data**:
```
file: [arquivo]
type: "thumbnail|video|material"
courseId: "uuid-curso-123"
```

**Par√¢metros**:
- `file` (file): Arquivo a ser enviado
- `type` (string): Tipo de arquivo
- `courseId` (string, opcional): ID do curso relacionado

**Tipos Suportados**:

**Thumbnail**:
- Formatos: JPEG, PNG, WebP
- Uso: Imagem de capa do curso

**Video**:
- Formatos: MP4, WebM, AVI, MOV
- Tamanho m√°ximo: 500MB
- Uso: V√≠deo-aulas

**Material**:
- Formatos: PDF, ZIP, DOC, TXT
- Uso: Materiais complementares

**Resposta de Sucesso (200)**:
```json
{
  "success": true,
  "url": "https://exemplo.com/uploads/videos/video_abc123def456.mp4",
  "type": "video",
  "filename": "video_abc123def456.mp4",
  "size": 52428800,
  "duration": 1800
}
```

**Para V√≠deos**:
```json
{
  "success": true,
  "url": "https://exemplo.com/uploads/videos/video_abc123.mp4",
  "type": "video",
  "filename": "video_abc123.mp4",
  "size": 52428800,
  "duration": 1800,
  "quality": "1080p",
  "thumbnail": "https://exemplo.com/uploads/thumbnails/video_abc123_thumb.jpg"
}
```

**Processamento Autom√°tico**:
- **Gera√ß√£o de Thumbnails**: Para v√≠deos
- **Extra√ß√£o de Dura√ß√£o**: Para m√≠dia
- **Compress√£o**: Para otimiza√ß√£o
- **Nome √önico**: UUID para evitar conflitos

**Valida√ß√µes**:
- Tipo de arquivo permitido
- Tamanho m√°ximo (500MB)
- Formato v√°lido

**Uso**: Upload de conte√∫do educacional

**Erros Poss√≠veis**:
- `400`: Arquivo ausente ou tipo inv√°lido
- `400`: Arquivo muito grande
- `401`: Token inv√°lido
- `500`: Erro no processamento

---

## üîß Configura√ß√µes Avan√ßadas

### N√≠veis de Curso
```javascript
const levels = {
  beginner: 'Iniciante',
  intermediate: 'Intermedi√°rio',
  advanced: 'Avan√ßado',
  expert: 'Especialista'
};
```

### Categorias Dispon√≠veis
```javascript
const categories = [
  'programacao',
  'design',
  'marketing',
  'negocios',
  'idiomas',
  'tecnologia',
  'saude',
  'arte'
];
```

### Status de Curso
```javascript
const statuses = {
  draft: 'Rascunho',
  published: 'Publicado',
  archived: 'Arquivado',
  maintenance: 'Em manuten√ß√£o'
};
```

### Configura√ß√µes de Acesso
```javascript
const settings = {
  allowDownloads: boolean,      // Permite downloads
  hasCertificate: boolean,      // Oferece certificado
  accessDuration: number,       // Dias de acesso
  maxStudents: number,          // Limite de alunos
  allowComments: boolean,       // Permite coment√°rios
  showProgress: boolean,        // Mostra progresso
  autoplay: boolean,           // Autoplay de v√≠deos
  watermark: boolean           // Marca d'√°gua
};
```

---

## üìä Integra√ß√µes e Automa√ß√µes

### Webhook de Matr√≠cula
Quando pagamento √© aprovado:
```javascript
// 1. Webhook recebe confirma√ß√£o
// 2. Busca pedido relacionado
// 3. Cria matr√≠cula autom√°tica
// 4. Envia email de boas-vindas
// 5. Libera acesso ao curso
```

### Sistema de Gamifica√ß√£o
```javascript
// TODO: Implementar
const gamification = {
  points: {
    lesson_completed: 10,
    module_completed: 50,
    course_completed: 100
  },
  badges: [
    'first_lesson',
    'fast_learner',
    'completionist'
  ]
};
```

### Certificados Autom√°ticos
```javascript
// TODO: Implementar
const certificate = {
  template: 'certificate_template.pdf',
  variables: ['student_name', 'course_title', 'completion_date'],
  signature: 'instructor_signature.png'
};
```

---

## üöÄ Melhorias Futuras

### Sistema de Coment√°rios
- Coment√°rios por aula
- Respostas do instrutor
- Sistema de likes/dislikes
- Modera√ß√£o autom√°tica

### Analytics Avan√ßados
- Tempo m√©dio por aula
- Taxa de abandono por m√≥dulo
- Engagement por tipo de conte√∫do
- Relat√≥rios de progresso

### Recursos Interativos
- Quizzes integrados
- Exerc√≠cios pr√°ticos
- Projetos finais
- Peer review

### Otimiza√ß√µes de Performance
- CDN para v√≠deos
- Streaming adaptativo
- Cache inteligente
- Compress√£o autom√°tica

---

**Pr√≥xima documenta√ß√£o**: `routes/admin.js` - Sistema administrativo
